<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Miembros | SBGA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="bg-gray-100">
  <script>
    const usuario = JSON.parse(localStorage.getItem("usuario"));
    if (!usuario) window.location.href = "index.html";
  </script>

  <div class="flex min-h-screen">
    <!-- index.html -->
    <div id="sidebar-container"></div>

    <script>
      fetch('aside.html')
        .then(res => res.text())
        .then(data => {
          document.getElementById('sidebar-container').innerHTML = data;
        })
        .catch(err => console.error('Error cargando el aside:', err));
    </script>

    <!-- Contenido principal -->
    <main class="flex-1 p-8 bg-gray-50">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h1 class="text-2xl font-bold text-gray-800">Lista de Miembros</h1>
          <p class="text-sm text-gray-500">Consulta los miembros registrados</p>
        </div>
        <a href="nuevo_miembro.html"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition text-sm font-medium">
          + Nuevo miembro
        </a>
      </div>

      <!-- Buscador -->
      <div class="mb-4">
        <input type="text" id="buscador" placeholder="Buscar en todos los campos..."
          class="w-full px-4 py-2 border border-gray-300 rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-red-400" />
      </div>

      <!-- Tabla -->
      <div id="loader" class="text-center text-gray-600">Cargando...</div>

      <div id="tabla-container" class="overflow-x-auto bg-white rounded-lg shadow hidden">
        <table class="min-w-full text-sm text-gray-800">
          <thead class="bg-gray-100 text-xs uppercase text-gray-600">
            <tr>
              <th class="px-4 py-3 text-left">EMPRESA</th>
              <th class="px-4 py-3 text-left">NOMBRE</th>
              <th class="px-4 py-3 text-left">APELLIDO</th>
              <th class="px-4 py-3 text-left">TIPO</th>
              <th class="px-4 py-3 text-left">CELULAR</th>
              <th class="px-4 py-3 text-left">EMAIL</th>
              <th class="px-4 py-3 text-left">SECTOR</th>
              <th class="px-4 py-3 text-left">DIRECCIÓN</th>
              <th class="px-4 py-3 text-left">TEL. EMPRESA</th>
              <th class="px-4 py-3 text-left">PAÍS</th>
            </tr>
          </thead>
          <tbody id="tabla-miembros" class="divide-y divide-gray-200"></tbody>
        </table>
      </div>
    </main>
  </div>

  <script>
    let datosMiembros = [];

    async function cargarMiembros() {
      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbwrqoyq40zHZ4ESTSRSaknEy0-calbBxLfmpKJZ4GruiQQKSxRCfjAgfC6QO1QqBrkH/exec?action=obtener_miembros");
        datosMiembros = await res.json();

        document.getElementById("loader").classList.add("hidden");
        document.getElementById("tabla-container").classList.remove("hidden");
        mostrarMiembros(datosMiembros);
      } catch (e) {
        Swal.fire("Error", "No se pudieron cargar los miembros", "error");
      }
    }

    function mostrarMiembros(lista) {
      const tbody = document.getElementById("tabla-miembros");
      tbody.innerHTML = "";

      lista.forEach(m => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="px-4 py-2">${m.nombre_empresa}</td>
          <td class="px-4 py-2">${m.nombre_contacto}</td>
          <td class="px-4 py-2">${m.apellido_contacto}</td>
          <td class="px-4 py-2">${m.tipo_miembro}</td>
          <td class="px-4 py-2">${m.celular}</td>
          <td class="px-4 py-2">${m.email}</td>
          <td class="px-4 py-2">${m.sector}</td>
          <td class="px-4 py-2">${m.direccion_empresa}</td>
          <td class="px-4 py-2">${m.telefono_empresa}</td>
          <td class="px-4 py-2">${m.pais}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById("buscador").addEventListener("input", function () {
      const filtro = this.value.toLowerCase();
      const filtrados = datosMiembros.filter(m =>
        Object.values(m).some(v => String(v).toLowerCase().includes(filtro))
      );
      mostrarMiembros(filtrados);
    });

    cargarMiembros();
  </script>
</body>

</html>